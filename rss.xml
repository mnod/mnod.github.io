<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>tech log</title><link>https://mnod.github.io/</link><description>tech log</description><atom:link href="https://mnod.github.io/rss.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2022 &lt;a href="mailto:mnod@example.com"&gt;mnod&lt;/a&gt; </copyright><lastBuildDate>Sun, 07 Aug 2022 09:20:50 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>ebs</title><link>https://mnod.github.io/posts/20220807.html</link><dc:creator>mnod</dc:creator><description>&lt;h3&gt;create an EBS volume and attach to an EC2 instance&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;aws ec2 create-volume --availability-zone ap-northeast-1a --volume-type gp3 --size 1 --encrypted --tag-specifications 'ResourceType=volume,Tags=[{Key=Name,Value=test_volume}]'
aws ec2 describe-volumes --volume-id vol-xxxx
aws ec2 attach-volume --device /dev/xvdb --instance-id i-xxxx --volume-id vol-xxxx
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;make partition and make filesystem&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;$ lsblk
$ sudo parted /dev/nvme1n1 print
$ sudo parted /dev/nvme1n1 mklabel gpt
$ sudo parted /dev/nvme1n1 mkpart home ext4 1MB 100%

$ sudo mkfs -t ext4 /dev/nvme1n1p1
$ sudo tune2fs -L homefs /dev/nvme1n1p1
$ ls -l /dev/disk/by-label/
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;edit /etc/fstab and reboot&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;$ sudo mount /dev/nvme1n1p1 /mnt
$ sudo cp -pri /home/ubuntu /mnt
$ sudo cp -pri /etc/fstab /etc/fstab.000
$ sudo vi /etc/fstab
$ diff /etc/fstab /etc/fstab.000
3d2

aws ec2 reboot-instances --instance-ids i-xxxx --dry-run
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;extend disk size&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;aws ec2 modify-volume --volume-id vol-xxxx --size 2
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;extend partition and filesystem&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ lsblk
$ sudo growpart /dev/nvme1n1 1

$ df -hT /home
$ sudo resize2fs /dev/nvme1n1p1
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;create snapshot&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;aws ec2 describe-snapshots --owner-id xxxx
aws ec2 create-snapshot --volume-id vol-xxxx --description 'test snapshot of homefs' --tag-specifications 'ResourceType=snapshot,Tags=[{Key=Name,Value=homefs}]'
aws ec2 describe-snapshots --owner-id xxxx --filters 'Name=volume-id,Values=vol-xxxx'
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;create new EBS volume from snapshot&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;aws ec2 create-volume --availability-zone ap-northeast-1a --snapshot-id snap-xxxx --volume-type gp3 --encrypted --tag-specifications 'ResourceType=volume,Tags=[{Key=Name,Value=test_volume}]'
aws ec2 describe-volumes --volume-id vol-yyyy
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;attach new volume and detach old volume&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;aws ec2 attach-volume --device /dev/xvdc --instance-id i-xxxx --volume-id vol-yyyy
aws ec2 stop-instances --instance-ids i-xxxx
aws ec2 detach-volume --no-force --instance-id i-xxxx --volume-id vol-xxxx
aws ec2 start-instances --instance-ids i-xxxx
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;delete volume&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;aws ec2 delete-volume --volume-id vol-yyyy
aws ec2 describe-volumes
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;delete snapshot&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;aws ec2 describe-snapshots --owner-id xxxx
aws ec2 delete-snapshot --snapshot-id snap-xxxx
&lt;/code&gt;&lt;/pre&gt;</description><category>aws</category><guid>https://mnod.github.io/posts/20220807.html</guid><pubDate>Sun, 07 Aug 2022 00:00:00 GMT</pubDate></item><item><title>let's encrrypt</title><link>https://mnod.github.io/posts/20220627.html</link><dc:creator>mnod</dc:creator><description>&lt;pre&gt;&lt;code&gt;certbot certonly \
--dry-run \
-d www.example.net \
-m yourname@example.net \
--preferred-challenges dns-01  \
--server https://acme-v02.api.letsencrypt.org/directory \
--manual \
--manual-auth-hook /home/user/work/letsencrypt/dns01-auth.sh \
--manual-cleanup-hook /home/user/work/letsencrypt/dns01-clean.sh \
--post-hook /home/user/work/letsencrypt/post-hook.sh \
--work-dir /home/user/work/letsencrypt/work \
--logs-dir /home/user/work/letsencrypt/logs \
--config-dir /home/user/work/letsencrypt/conf
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;When you run certbot in non-root user, you have to specify --work-dir, --logs-dir, and --config-dir options.  These directories have to be writable with your user.&lt;/li&gt;
&lt;li&gt;You can only publish new certificate file via certbot. Your new certificate file will pushed under config-dir directory. Afterward, you can deploy it with your deploy tool which you like. &lt;/li&gt;
&lt;li&gt;The dns-01 challenge authentication only needs DNS validation and don't need to access via 80/tcp nor web server installation on your server.
When you use dns-01 challenge, you can use your script to update your dns resource to --manual-auth-hook (for authentication) and --manual-cleanup-hook (for cleanup entry).&lt;br&gt;
CERTBOT_DOMAIN varaible is used to show domain name which you want to use. CERTBOT_VALIDATION vaibale is used to show validation code.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;sample script which create validtion entry for aws route53&lt;/p&gt;
&lt;script src="https://gist.github.com/mnod/0ed9ec48287d3a785a1e648911720b37.js?file=dns01-auth.sh"&gt;&lt;/script&gt;

&lt;p&gt;sample script which delete validtion entry for aws route53&lt;/p&gt;
&lt;script src="https://gist.github.com/mnod/0ed9ec48287d3a785a1e648911720b37.js?file=dns01-clean.sh"&gt;&lt;/script&gt;

&lt;pre&gt;&lt;code&gt;certbot renew \
--dry-run \
--post-hook /home/user/work/letsencrypt/post-hook.sh \
--work-dir /home/user/work/letsencrypt/work \
--logs-dir /home/user/work/letsencrypt/logs \
--config-dir /home/user/work/letsencrypt/conf
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;Once you get your new certificate, you have to update your certificate periodically.&lt;/li&gt;
&lt;/ul&gt;</description><category>aws</category><category>linux</category><category>openssl</category><guid>https://mnod.github.io/posts/20220627.html</guid><pubDate>Mon, 27 Jun 2022 00:00:00 GMT</pubDate></item><item><title>network time security</title><link>https://mnod.github.io/posts/20220615.html</link><dc:creator>mnod</dc:creator><description>&lt;p&gt;&lt;a href="https://fedoramagazine.org/secure-ntp-with-nts/"&gt;Secure NTP with NTS&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Chrony supports nts since version 4.0. I tried to build nts server and client.&lt;/p&gt;
&lt;h3&gt;server configuration&lt;/h3&gt;
&lt;p&gt;example of chrony 4.2 on ubuntu 22.04 LTS&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;server time.facebook.com iburst maxpoll 11
server time.google.com   iburst maxpoll 11
server time.apple.com    iburst maxpoll 11

ntsserverkey /etc/chrony/key.pem
ntsservercert /etc/chrony/crt.pem
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;key.pem and crt.pem are openssl private key and certificate(with intermediate ca certificate) file pair.
The certificate needs to include your fqdn of your nts server.&lt;/p&gt;
&lt;p&gt;When I put key and crt files in a sub directory of /etc/ssl, below error occured.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Could not set credentials : Error while reading file.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In /var/log/syslog, I found audit log of apparmor which shows it denied for chronyd to open the key file.
When I put them in /etc/chrony, I successed to run it.&lt;/p&gt;
&lt;p&gt;Before test from client, you have to open not only 123/udp for NTP but also 4460/tcp for NTS-KE.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ chronyd -Q -t 8 'server mynts.example.com iburst nts'
$ sudo chronyc serverstats
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;client configuration&lt;/h3&gt;
&lt;p&gt;example of chrony 4.0 on Debian 11&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;server mynts.example.com iburst nts
server ptbtime1.ptb.de   iburst nts
server nts.time.nl       iburst nts
server nts.ntp.se        iburst nts

ntstrustedcerts /etc/chrony/cacert.crt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When you use selfsigned CA to make your certificate in the nts server, you have to show your own ca certificate file to chrony.conf in ntstrustedcerts.&lt;/p&gt;</description><category>linux</category><category>ntp</category><guid>https://mnod.github.io/posts/20220615.html</guid><pubDate>Wed, 15 Jun 2022 00:00:00 GMT</pubDate></item><item><title>wireguard on raspberryrpi</title><link>https://mnod.github.io/posts/20220614.html</link><dc:creator>mnod</dc:creator><description>&lt;p&gt;I tried to install wireguard with &lt;a href="https://docs.pivpn.io/install/"&gt;pivpn&lt;/a&gt; on 64bit Raspberry pi OS (buster, 4B), but it failed&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ cat &amp;lt;&amp;lt; END &amp;gt; /tmp/pivpn_options.conf                                                                                                                                           
IPv4dev=xx
install_user=pi
VPN=wireguard
pivpnNET=10.x.x.0
subnetClass=24
ALLOWED_IPS="10.x.x.0/24, 192.168.y.0/24"
pivpnMTU=1420
pivpnPORT=51820
pivpnDNS1=1.1.1.1
pivpnHOST=myname.example.com
pivpnPERSISTENTKEEPALIVE=25
UNATTUPG=1
END

$ curl -L https://install.pivpn.io &amp;gt; /tmp/pivpn_install.sh
$ chmod +x /tmp/pivpn_install.sh
$ /tmp/pivpn_install.sh --noipv6 --unattended /tmp/pivpn_options.conf                                                                                                     


:: wireguard is not a supported VPN protocol on arm64 Debian, only 'openvpn' is
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I was not able to select wireguard in intereractive interface. It select openvpn automatically.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ /tmp/pivpn_install.sh --noipv6
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Though I successed it on 32bit Raspberry pi OS (bullseye, 3B+)
It needs NAPT settings to your pi to make a connection from outside wireguard peer.&lt;/p&gt;
&lt;p&gt;I'd like to try it on bookwarm 32bit/64bit when it will be released on the next version of the pi :)&lt;/p&gt;</description><category>failed</category><category>linux</category><category>raspberrypi</category><category>vpn</category><guid>https://mnod.github.io/posts/20220614.html</guid><pubDate>Tue, 14 Jun 2022 00:00:00 GMT</pubDate></item><item><title>WebARENA Indigo API</title><link>https://mnod.github.io/posts/20220521.html</link><dc:creator>mnod</dc:creator><description>&lt;p&gt;&lt;a href="https://web.arena.ne.jp/indigo/"&gt;WebARENA Indigo&lt;/a&gt; is one of the cheapest VPS services in Japan.
It can be controlled via &lt;a href="https://indigo.arena.ne.jp/userapi/"&gt;Rest-API&lt;/a&gt; for some functions.&lt;/p&gt;
&lt;h3&gt;create API key and API secret key&lt;/h3&gt;
&lt;p&gt;Before you use the Rest-API, you have to access controle panel and create API key and API secret key.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;access &lt;a href="https://indigo.arena.ne.jp/"&gt;Indigo ダッシュボード&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;click API鍵の管理 on the left side menu then select API鍵&lt;/li&gt;
&lt;li&gt;click API鍵の作成 on the top of right side&lt;/li&gt;
&lt;li&gt;write down API鍵 and API秘密鍵 &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you'd like to do so, set them as environment variable&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ cat &amp;lt;&amp;lt; END &amp;gt; ~/.webarena_secret
&amp;gt; export IndigoApiKey=xxxx
&amp;gt; export IndigoApiPrivateKey=xxxx
&amp;gt; END
$ chmod 600 ~/.webarena_secret
$ cat &amp;lt;&amp;lt; END &amp;gt;&amp;gt; ~/.bashrc
&amp;gt; if [ -f ~/.webarena_secret ]; then
&amp;gt;   . ~/.webarena_secret
&amp;gt; fi
&amp;gt; END
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;create API token&lt;/h3&gt;
&lt;p&gt;After create API key and API secret key, you can create API token.
You need this API token to call other Rest-APIs.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;IndigoToken=$(curl -s -X POST \
  https://api.customer.jp/oauth/v1/accesstokens\
  -H 'Content-Type: application/json' \
  -d '{
    "grantType": "client_credentials",
    "clientId": "'${IndigoApiKey}'",
    "clientSecret": "'${IndigoApiPrivateKey}'",
    "code": ""
}' | jq -r .accessToken)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The output of this API includes &lt;em&gt;"expiresIn": "3599"&lt;/em&gt;.
I have not confirmed but it would expire in about 3600 seconds.&lt;/p&gt;
&lt;h3&gt;register ssh key&lt;/h3&gt;
&lt;p&gt;ssh key will be installed in ~/.ssh/authorized_keys of login user when the instance will be created.
You can register your own ssh public key instead of create it.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/sshkey \
  -H "Authorization: Bearer ${IndigoToken}" \
  -d '{
   "sshName": "testkey",
   "sshKey": "ssh-rsa xxxx"
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When I tested to upload "ed25519" public key but I got error message like below.
It seems they don't allow ed25519 keys.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{"success":false,"errorMessage":"Invalid SSH key.","errorCode":"I10034"}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;retrieve information to create instance&lt;/h3&gt;
&lt;p&gt;list ssh keys&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/sshkey \
  -H "Authorization: Bearer ${IndigoToken}" | jq .
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list regions&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;instanceTypeId=$(curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/instancetypes \
  -H "Authorization: Bearer ${IndigoToken}" | jq '.instanceTypes[] | select(.name == "instance") | .id')
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/getregion?instanceTypeId=${instanceTypeId} \
  -H "Authorization: Bearer ${IndigoToken}" | jq .
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list os&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/oslist?instanceTypeId=${instanceTypeId} \
  -H "Authorization: Bearer ${IndigoToken}" | jq .
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list instance plans&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X GET \
  'https://api.customer.jp/webarenaIndigo/v1/vm/getinstancespec?instanceTypeId='${instanceTypeId}'&amp;amp;osId=xx' \
  -H "Authorization: Bearer ${IndigoToken}" | jq .
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;create instance&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/createinstance \
  -H "Authorization: Bearer ${IndigoToken}" \
  -d '{
  "sshKeyId": xxxx,
  "regionId": x,
  "osId": xx,
  "instancePlan": x,
  "instanceName": "xxxx"
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list instances&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/getinstancelist \
  -H "Authorization: Bearer ${IndigoToken}"
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When you create an instance, "instancestatus" will be "OS installation In Progress".
After a while it will become "Stopped". It is a time to start your instance.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/instance/statusupdate \
  -H "Authorization: Bearer ${IndigoToken}" \
  -d '{"instanceId":"xxxx","status":"start"}'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After you start your instance, "instancestatus" will become "Running"&lt;/p&gt;
&lt;h3&gt;firewall&lt;/h3&gt;
&lt;p&gt;The rule is a allow list.
When you create a firewall rule and apply it to your instance, others will be denied.&lt;/p&gt;
&lt;p&gt;create firewall rule&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/nw/createfirewall \
  -H "Authorization: Bearer ${IndigoToken}" \
  -d '{
    "name":"xxxx",
    "inbound":[
        {"type":"Custom","protocol":"TCP","port":"22","source":"x.x.x.x"}
    ],
    "instances":["xxxx"]
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Above rule only allow ssh connection from x.x.x.x. All other inbound connection will be denied.
Since there are no outbound rules, all outbound connection will be allowed&lt;/p&gt;
&lt;p&gt;list firewall&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/nw/getfirewalllist \
  -H "Authorization: Bearer ${IndigoToken}"
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;describe a firewall rule&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/nw/gettemplate/xxxx \
  -H "Authorization: Bearer ${IndigoToken}"
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;update firewall&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -s -X PUT \
  https://api.customer.jp/webarenaIndigo/v1/nw/updatefirewall \
  -H "Authorization: Bearer ${IndigoToken}" \
  -d '{
    "templateid":"xxxx",
    "name":"xxxx",
    "inbound":[
        {"type":"Custom","protocol":"UDP","port":"123","source":"0.0.0.0"},
        {"type":"Custom","protocol":"TCP","port":"22","source":"x.x.x.x"}
    ],
    "instances":["xxxx"]
}'
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;snapshot&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;stop instance&lt;/li&gt;
&lt;li&gt;create/restore snapshot&lt;/li&gt;
&lt;li&gt;start instance&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When start instance after restore from snapshot, the boot process may stack at GRUB.
You can confirm the situation at QEMU console.&lt;/p&gt;
&lt;p&gt;How to access the console:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;access &lt;a href="https://indigo.arena.ne.jp/"&gt;Indigo ダッシュボード&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;click instance management on the left side menu then select instance.&lt;/li&gt;
&lt;li&gt;click select on the right side of the target instance and select access.&lt;/li&gt;
&lt;li&gt;click "start console"&lt;/li&gt;
&lt;li&gt;If it has stacked at GRUB, click force stop of the left side. After stop, start it again.&lt;/li&gt;
&lt;/ol&gt;</description><category>hosting</category><guid>https://mnod.github.io/posts/20220521.html</guid><pubDate>Sat, 21 May 2022 00:00:00 GMT</pubDate></item><item><title>copy partition of sd card</title><link>https://mnod.github.io/posts/20220328.html</link><dc:creator>mnod</dc:creator><description>&lt;p&gt;dump partition of original sd card&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo parted /dev/sdx print
sudo dd if=/dev/sdx1 of=tablet_sdx1.img bs=4M
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;restore to new sd card&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo parted /dev/sdx print
sudo dd if=tablet_sdx1.img of=/dev/sdx1 bs=4M
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;confirm the size of filesystem&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo mount /dev/sdb1 /media/tmp
df
sudo umount /media/tmp
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;extend the filesystem (if needed)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt install --no-install-recommends fatresize
sudo fatresize -i /dev/sdb1
max=$(expr $(sudo fatresize -i /dev/sdb1 | awk -F: '$1~/Max size/{print $2}') / 1024)
sudo fatresize -s ${max}k /dev/sdb1
sudo fatresize -i /dev/sdb1
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;confirm the size of filesystem&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo mount /dev/sdb1 /media/tmp
df
&lt;/code&gt;&lt;/pre&gt;</description><category>linux</category><guid>https://mnod.github.io/posts/20220328.html</guid><pubDate>Mon, 28 Mar 2022 00:00:00 GMT</pubDate></item><item><title>k3s using docker runtime</title><link>https://mnod.github.io/posts/20210629.html</link><dc:creator>mnod</dc:creator><description>&lt;p&gt;&lt;em&gt;install single-node k3s cluster instead of containerd&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I can install with these commands on debian buster arm64 though can not on bullseye.&lt;/p&gt;
&lt;p&gt;at first intall docker&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo apt-get update
sudo apt-get install ca-certificates curl gnupg lsb-release
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo \
"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \
$(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io
sudo docker run hello-world
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;then install k3&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -sfL https://get.k3s.io | sh -s - --docker
systemctl status k3s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;uninstall&lt;/em&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/usr/local/bin/k3s-uninstall.sh
&lt;/code&gt;&lt;/pre&gt;
&lt;!--
sudo kubectl get pods --all-namespaces
sudo kubectl get pods --all-namespaces -o wide

sudo kubectl get rs
sudo kubectl scale rs/&lt;rs name&gt; --replicas=0

sudo kubectl exec &lt;pod name&gt; -- &lt;command ...&gt;
sudo kubectl exec -it &lt;pod name&gt; -- /bin/sh
sudo kubectl delete pod &lt;pod name&gt;

sudo kubectl get nodes
sudo kubectl get nodes -o wide
--&gt;

&lt;p&gt;&lt;em&gt;create deployment&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;create yaml file&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF &amp;gt; nginx-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx-test
        image: nginx-test:latest
        imagePullPolicy: Never
        ports:
        - containerPort: 80
EOF
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;create and confirm the deployment&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo kubectl create -f nginx-deployment.yaml
sudo kubectl get deploy
sudo kubectl get pod
sudo kubectl exec -it &amp;lt;pod name&amp;gt; -- curl localhost
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;create service&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;create yaml file&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cat &amp;lt;&amp;lt;EOF &amp;gt; nginx-service.yaml
kind: Service
apiVersion: v1
metadata:
  name: my-service
spec:
  type: NodePort
  selector:
    app: nginx
  ports:
  - protocol: TCP
    targetPort: 80
    port: 80
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;create and confirm the service &lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo kubectl create -f nginx-service.yaml
sudo kubectl get svc
curl x.x.x.x
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;modify service&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo kubectl apply -f nginx-deployment.yaml
sudo kubectl get svc
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;delete srvice&lt;/em&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo kubectl delete svc &amp;lt;service name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;delete deployment&lt;/em&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;sudo kubectl delete -f ./nginx-deployment.yaml
&lt;/code&gt;&lt;/pre&gt;</description><category>docker</category><category>linux</category><guid>https://mnod.github.io/posts/20210629.html</guid><pubDate>Wed, 29 Dec 2021 00:00:00 GMT</pubDate></item><item><title>Bluetooth tethering on Windows10</title><link>https://mnod.github.io/posts/20211031.html</link><dc:creator>mnod</dc:creator><description>&lt;h2&gt;connect&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Pairing&lt;/li&gt;
&lt;li&gt;To open &lt;code&gt;Bluetooth Personal Area Network Device&lt;/code&gt;, right click the blootooth icon in the system tray and click &lt;code&gt;Join a Personal Area Network&lt;/code&gt;.
You can create a shortcut to it where you like.&lt;/li&gt;
&lt;li&gt;Right click the icon of your router device and select &lt;code&gt;Connect using&lt;/code&gt; then click &lt;code&gt;Access Point&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you use an iphone as your router device, you don't have to tap 'internet sharing' when you start bluetooth tethering.&lt;/p&gt;
&lt;h2&gt;disconnect&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Open &lt;code&gt;Bluetooth Personal Area Network Device&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Right click the icon of your router device and click &lt;code&gt;disconnect&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;data usage limit&lt;/h2&gt;
&lt;p&gt;When we use wifi on windows, we have configuration for metered connection but we don't generally when blootooth pan.&lt;/p&gt;
&lt;p&gt;I heard that it would be possible to limit data usage by editing registry.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;run &lt;code&gt;regedit&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;open &lt;code&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\DefaultMediaCost&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;get full control of it for administrators&lt;/li&gt;
&lt;li&gt;change value of &lt;code&gt;Ethernet&lt;/code&gt; to &lt;code&gt;2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;restart windows&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This configures also ethernet to metered connection.&lt;/p&gt;</description><category>windows</category><guid>https://mnod.github.io/posts/20211031.html</guid><pubDate>Sun, 31 Oct 2021 00:00:00 GMT</pubDate></item><item><title>Grandstream GXP1610</title><link>https://mnod.github.io/posts/20211030.html</link><dc:creator>mnod</dc:creator><description>&lt;p&gt;&lt;a href="http://www.grandstream.com/products/ip-voice-telephony-gxp-series-ip-phones/gxp-series-basic-ip-phones/product/gxp1610/gxp1615"&gt;GXP1610&lt;/a&gt; は 1SIP 対応の IP電話機。
液晶バックライトを搭載してたり、2SIPに対応していたり、PoE対応、Gigabit Ethernet対応してるような上級機がある中の入門機。&lt;/p&gt;
&lt;p&gt;以下、備忘録&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;説明書はペラペラ。必要な情報は&lt;a href="http://www.grandstream.com/support/resources?title=GXP1610/GXP1615&amp;amp;hsLang=en"&gt;自ら取りに行く姿勢&lt;/a&gt;が求められる&lt;/li&gt;
&lt;li&gt;スタンドの取り付け向きに注意&lt;/li&gt;
&lt;li&gt;スイッチからのケーブルをLANに、PCへのケーブルをPCへ接続すると、ハブ(?)として動作してくれる(10/100Mbps)&lt;/li&gt;
&lt;li&gt;DHCPが有効なネットワークに接続してほどなくするとIPアドレスを取れる&lt;/li&gt;
&lt;li&gt;ディスプレイにIPアドレスが表示されるので、PCからWebアクセスすると、管理画面を表示できる&lt;/li&gt;
&lt;li&gt;管理画面の初期パスワードは同梱の説明書に記載されている。初めてログインすると変更が促される。ログイン時に5回間違えるとやばい&lt;/li&gt;
&lt;li&gt;Web UI、端末の液晶とも、多言語対応(日本語表示可能)&lt;/li&gt;
&lt;li&gt;試していないがIPアドレスは静的アドレスを設定可能なようだ&lt;/li&gt;
&lt;li&gt;設定済みのAsteriskに収容するだけなら、Web UI で SIPサーバ、ID、パスワード等を設定するだけなので、簡単&lt;/li&gt;
&lt;li&gt;SIPアカウント設定の画面で、Voice Mail Access Number を設定すると、メールアイコンのボタンを押すことで、VoiceMail に架電することができる&lt;/li&gt;
&lt;li&gt;NTPサーバを指定できる&lt;/li&gt;
&lt;li&gt;Syslog転送できる(facility=user)&lt;/li&gt;
&lt;li&gt;試していないけど、SNMPサーバを指定できるようだ&lt;/li&gt;
&lt;li&gt;試していないけど、LDAPの電話帳が使えるようだ&lt;/li&gt;
&lt;/ul&gt;</description><category>linux</category><category>voip</category><guid>https://mnod.github.io/posts/20211030.html</guid><pubDate>Sat, 30 Oct 2021 00:00:00 GMT</pubDate></item><item><title>rpm package management</title><link>https://mnod.github.io/posts/20211024.html</link><dc:creator>mnod</dc:creator><description>&lt;p&gt;list installed packages&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# rpm -qa [package name]
# yum list [package name]
# dnf list [package name]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;install package / rpm file&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# rpm -ivh &amp;lt;rpm file name&amp;gt;
# microdnf install &amp;lt;package name&amp;gt;
# dnf install &amp;lt;package name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list installed files&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# rpm -ql &amp;lt;package name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list repositories&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yum repolist [repository name] [-v]
# microdnf repolist
# dnf repolist [repository name] [-v]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;show packages contained in the repository&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yum repository-packages [repository name] list
# dnf repository-packages [repository name] list
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;disable or enable repository with &lt;code&gt;config-manager&lt;/code&gt; module contained in &lt;code&gt;yum-utils&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yum config-manager &amp;lt;--set-disabled|--set-enabled&amp;gt; epel
# dnf config-manager &amp;lt;--set-disabled|--set-enabled&amp;gt; epel
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;update installed packages&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yum update
# microdnf update
# dnf update
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;download rpm file with &lt;code&gt;yumdownloader&lt;/code&gt; which is a part of &lt;code&gt;yum-utils&lt;/code&gt; package.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yumdownloder &amp;lt;package name&amp;gt;
# yumdownloder &amp;lt;package name&amp;gt;.&amp;lt;version&amp;gt;.&amp;lt;architecture&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list files contained in a rpm file&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# rpm2cpio &amp;lt;rpm file&amp;gt; | cpio --list
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;extract a rpm file in the current directory&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# rpm2cpio &amp;lt;rpm file&amp;gt; | cpio -id
# find . -type f
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;remove installed package&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# rpm -e &amp;lt;pakcage name&amp;gt;
# yum remove &amp;lt;pakcage name&amp;gt;
# microdnf remove &amp;lt;pakcage name&amp;gt;
# dnf remove &amp;lt;pakcage name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;remove all cached data&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yum clean all
# microdnf clean
# dnf clean all
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;show transaction history&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# yum history
# dnf history
&lt;/code&gt;&lt;/pre&gt;</description><category>linux</category><guid>https://mnod.github.io/posts/20211024.html</guid><pubDate>Sun, 24 Oct 2021 00:00:00 GMT</pubDate></item></channel></rss>