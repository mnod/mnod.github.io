date: 2022/08/10
title: advanced cloudformation
tags: aws

create an initial cloudformation stack

	aws cloudformation validate-template --template-body file://template-000.yml
	aws cloudformation create-stack --stack-name mystack  --template-body file://mystack-000.yml

confirm the result

	aws cloudformation describe-stacks --stack-name mystack 
	aws cloudformation describe-stack-resources --stack-name mystack 
	aws cloudformation describe-stack-events --stack-name mystack 

## change set

create change set after editing template file

	aws cloudformation create-change-set --stack-name mystack --template-body file://mystack-001.yml --tags 'Key=Name,Value=0502115-roleplay' --change-set-name mystack-001 --description 'create new Internet Gateway'
	aws cloudformation list-change-sets --stack-name mystack 
	aws cloudformation describe-change-set --stack-name mystack --change-set-name mystack-001

execute the change set

	aws cloudformation execute-change-set --stack-name mystack --change-set-name mystack-001
	aws cloudformation list-change-sets --stack-name mystack 

## drift

detect stack drift after manual operation

	aws cloudformation detect-stack-drift --stack-name mystack 
	aws cloudformation describe-stack-resource-drifts --stack-name mystack 

create change set after editing template file to fit to current resource

	aws cloudformation create-change-set --stack-name mystack --template-body file://mystack-002.yml --tags 'Key=Name,Value=0502115-roleplay' --change-set-name mystack-002 --description 'reflect manual operation'
	aws cloudformation list-change-sets --stack-name mystack 
	aws cloudformation describe-change-set --stack-name mystack --change-set-name mystack-002

execute the change set

	aws cloudformation execute-change-set --stack-name mystack --change-set-name mystack-002

remove change set when the status is false

	aws cloudformation delete-change-set --stack-name mystack --change-set-name mystack-002

## import


