title: removal of old kernel packages in ubuntu
date: 2016/09/11
tags: linux, ubuntu

新しいカーネルをインストールした後、元のカーネルパッケージを削除せずそのままにしておくと、/bootを小さく切っている場合など、ディスク領域を圧迫してくる場合があります。
そんな時は、使用していない古いカーネルを削除することで、ディスクに空きを作ることができます。

以下、Ubuntuで、使用していない古いカーネルを削除する流れです。

現在のディスク使用状況を確認

    $ df -h /boot

現在のカーネルの情報を確認

    $ uname -a

インストールされているカーネルパッケージのバージョンを確認し、不要なバージョンがどれなのかを調べる。

    $ dpkg -l | awk '$2~/^linux/ {print}'

バージョンを指定して、削除対象のパッケージを抽出する
(カーネルだけでなく、カーネルソース等の関連パッケージも削除対象とする)

    $ dpkg -l | awk '$2~/^linux/ {print $2}' | grep x.xx.x-xx

削除を実行

    $ dpkg -l | awk '$2~/^linux/ {print $2}' | grep x.xx.x-xx | xargs sudo aptitude -y purge

不要なパッケージが削除されたことを確認

    $ dpkg -l | awk '$2~/^linux/ {print $2}' | grep x.xx.x-xx

現在のディスク使用状況を確認

    $ df -h /boot

以上、不要なバージョンを全て削除するまで繰り返して実行する。

自分は、現在使っているカーネルの他に、何か問題が発生した際の保険として、一世代前のカーネルも削除せずに残すようにしています。
